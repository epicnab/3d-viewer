<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>3D Model Viewer with Share</title>
    <script
      type="module"
      src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"
    ></script>
    <style>
      .box {
        display: flex;
        justify-content: center;
        margin: 20px;
        gap: 10px;
        flex-wrap: wrap;
      }
      model-viewer {
        width: 800px;
        height: 600px;
        border: 1px solid #ccc;
      }
      input {
        padding: 8px;
        width: 400px;
      }
      button {
        padding: 8px 16px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="box">
      <input
        type="text"
        id="modelLink"
        placeholder="Masukkan link .glb di sini"
      />
      <button onclick="loadModel()">Load Model</button>
      <button onclick="shareModel()">Share</button>
    </div>

    <div class="box">
      <model-viewer
        id="viewer"
        src=""
        camera-controls
        disable-zoom
        auto-rotate="false"
        interaction-prompt="none"
        camera-orbit="0deg 75deg 2.5m"
      ></model-viewer>
    </div>

    <div class="box">
      <button onclick="rotateHorizontal(-10)">⟲ Rotate Left</button>
      <button onclick="rotateHorizontal(10)">⟳ Rotate Right</button>
      <button onclick="rotateVertical(-10)">⮝ Tilt Up</button>
      <button onclick="rotateVertical(10)">⮟ Tilt Down</button>
    </div>

    <script>
      const viewer = document.getElementById("viewer");
      const modelInput = document.getElementById("modelLink");

      let theta = 0;
      let phi = 75;
      const radius = "2.5m";

      function updateCameraOrbitInstant() {
        viewer.cameraOrbit = `${theta}deg ${phi}deg ${radius}`;
        viewer.jumpCameraToGoal();
      }

      function rotateHorizontal(degrees) {
        theta = (theta + degrees) % 360;
        updateCameraOrbitInstant();
      }

      function rotateVertical(degrees) {
        phi = Math.max(-90, Math.min(90, phi + degrees));
        updateCameraOrbitInstant();
      }

      function loadModel() {
        const url = modelInput.value.trim();
        if (!url.endsWith(".glb")) {
          alert("Harap masukkan link file .glb yang valid.");
          return;
        }
        viewer.src = url;
        viewer.addEventListener("load", () => {
          updateCameraOrbitInstant();
        });
      }

      function shareModel() {
        const url = modelInput.value.trim();
        if (!url) {
          alert("Masukkan link model terlebih dahulu.");
          return;
        }
        const shareUrl = `${window.location.origin}${
          window.location.pathname
        }?model=${encodeURIComponent(url)}`;
        navigator.clipboard.writeText(shareUrl).then(() => {
          alert("Link berhasil disalin:\n" + shareUrl);
        });
      }

      // Auto load model if URL has ?model=...
      const params = new URLSearchParams(window.location.search);
      const modelFromURL = params.get("model");
      if (modelFromURL) {
        modelInput.value = modelFromURL;
        viewer.src = modelFromURL;
        viewer.addEventListener("load", () => {
          updateCameraOrbitInstant();
        });
      }
    </script>
  </body>
</html>
